
# Домашнее задание

Для решения понадобится установить планировщик задач cron
```bash
sudo apt install cron
```

### Пример
Cron - мощный инструмент для планирования периодических задач. 
Давайте познакомимся с ним на небольшом примере
Будем каждую минуту создавать файл, `<timestamp>.txt`, который будет содержать текст "Hello, cron world!"

Для этих целей, нам нужно написать скрипт, который будет выполняться каждую минуту.
```bash
#!/bin/bash

echo "Hello, cron world!" > /<insert>/<your>/<path>/$(date +%s).txt
```

Теперь добавим задачу на его выполнение. Все задачи cron описываются в специальном файле,
который можно открыть следующей командой:
```bash
crontab -e
```
Cron предложит выбрать средство для открытия файла - это может быть vim, nano или какой-то другой текстовый редактор.

Как же задавать время выполнения? Давайте рассмотрим пару примеров [(взято отсюда)](https://basis.gnulinux.pro/ru/latest/basis/37/37._%D0%9F%D0%BB%D0%B0%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D1%89%D0%B8%D0%BA%D0%B8_%D0%B7%D0%B0%D0%B4%D0%B0%D1%87.html):

* `* * * * * touch file` - каждую минуту выполнять команду `touch file`.
* `0 * * * * touch file2` - раз в каждый час, в нулевую минуту, выполнять команду `touch file2`.
* `0 0 * * * touch file3` - раз в день, в 00:00, выполнять команду `touch file3`.
* `3 5 15 * * touch file4` - каждого 15 числа любого месяца в 5:03 выполнять команду `touch file4`.
* `10 15 20 5 * touch file5` - каждого 20 мая в 15:10 выполнять команду `touch file5`.

Для наших целей подойдёт первый вариант. Добавим в конец файла (открытого с помощью `crontab -e`):
```cron
* * * * * /<insert>/<your>/<path>/script.bash
```

### Задача

Существует такой [репозиторий на гитхаб](https://github.com/public-apis/public-apis), на котором собраны и каталогизированы ссылки
на разные открытые api.

Давайте остановимся на [CoinCap](https://docs.coincap.io/)

Ваша задача - создать скрипт, который будет выполняться, если соблюдаются следующие условия:
1. текущая минута - либо от 0 до 10, либо четная, либо делится на 7, либо в промежутке от 40 до 59
2. текущий час - в промежутке от 8 до 17, либо в промежутке от 20 до 23
3. текущий день месяца - в промежутке от 1 до 15, либо от 20 до 30
4. текущий месяц - любой
5. день недели - любой, кроме воскресенья

Сам скрипт должен получать данные о цене биткоине и сохранять их в файл `Bitcoin_<timestamp>.txt`.
`timestamp` можно брать либо системный, либо приходящий с сервера.

## Решение

Установим необходимые пакеты:
```bash
sudo apt install curl jq cron
```

Теперь склонируем проект:
```bash
git clone https://github.com/Krakozaybr/informatics-lab6
```

Создадим файл скрипта `script.bash`:
```bash
nano script.bash
```

Запишем в него следующий код:
```bash
#!/bin/bash

# Получаем папку, содержащую файл скрипта
SCRIPT_DIR=$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )

# С помощью curl получаем данные о биткоине
JSON=$( curl -s https://api.coincap.io/v2/assets/bitcoin )

# С помощью jq парсим json и получаем нужное цену и timestamp
PRICE=$( echo "${JSON}" | jq -r ".data.priceUsd" )
TIMESTAMP=$( echo "${JSON}" | jq -r ".timestamp" )

# Пишем данные в текстовый файл
echo "${PRICE}" >> "${SCRIPT_DIR}/Bitcoin_${TIMESTAMP}.txt"
```

На всякий случай проверим, что скрипт работает:
```bash
bash script.bash
```

Создался файл `Bitcoin_<timestamp>.txt` с нужными данными.

Теперь запланируем скрипт на выполнение:
```bash
crontab -e
```
Для каждого условия напишем соответствующую инструкцию:
1. Минуты - `0-10,*/2,*/7,40-59`
2. Часы - `8-17,20-23`
3. Дни - `1-15,20-30`
4. Месяцы - `*`
5. Дни недели - `1-6`

Выполнение самой команды:
```bash
bash /home/krakozaybr/informatics-lab6/script.bash
```

Итого:
```
0-10,*/2,*/7,40-59 8-17,20-23 1-15,20-30 * 1-6 bash /home/krakozaybr/informatics-lab6/script.bash
```

Работа сделана!

## Источники
[Статья про планировщики at и cron](https://basis.gnulinux.pro/ru/latest/basis/37/37._%D0%9F%D0%BB%D0%B0%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D1%89%D0%B8%D0%BA%D0%B8_%D0%B7%D0%B0%D0%B4%D0%B0%D1%87.html)<br>
[Статья про cron на habr](https://habr.com/ru/companies/skillfactory/articles/656423/)<br>
[Документация cron](https://man7.org/linux/man-pages/man5/crontab.5.html)<br>
[Источник где можно найти все](https://google.com)